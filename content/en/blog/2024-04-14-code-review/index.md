---
title: Code review
date: 2024-04-13
---

In this post:

- 為何做 code review？
- 走味的 code review。

## 為何做 code review？

實施 code review 的兩個主要理由：提高程式品質，以及傳遞知識。

### 提高程式品質

Code review 可提升程式碼的品質，包括可讀性、可維護性等等，並減少應用程式的 bug。

程式碼的品質提高，洩漏至產品的 bug 數量減少，便能降低未來產品上線後的問題反饋、排查、debug、和部署新版本的成本。

### 促進了解，傳遞知識

- 新人可透過 code review 加速上手。
- 減少知識壁壘。code review 過程是公開透明的，所有團隊成員都能看到。
- 透過公開的溝通與討論，可了解其他人的想法，互相傳遞經驗與知識。

---

有了上述優點，實踐 code review 的團隊理論上應該會更快樂。然而實際上是否如此，恐怕要打個問號，因為在實施 code review 過程中還有許多「眉角」，一不小心就會走偏。接著就來看看有哪些需要注意的地方。

## 走味的 code review

這裡談一下走味的 code review，意思是實際 code review 而導致的一些扭曲現象或者 anti-patterns。

### 馬馬虎虎

當團隊中的每一位成員當忙於衝刺自己手上預先排定的工作，很可能沒有時間和心力去看別人寫的 code 並提出建議。也許今天比較有空，就看一下別人的 pull request；若沒空，就隨便瞄幾眼，或者跳過（反正還有其他人會看，應該吧？）。

> GitHub 的 pull request (PR)，在 GitLab 叫做 merge request (MR)。以下用 PR 來簡稱 pull request 或 merge request。

想像一下，某一個 PR 裡面包含上千行的程式碼，變動橫跨二、三十個檔案，這樣的 PR 要花多少心力和時間去仔細 review？

於是可能出現一種情形：少量變動的 PR，容易獲得其他人的 review 建議；<mark>若 PR 變動量大到一個程度，review 建議可能就只有四個字母：LGTM。</mark>也就是 looks good to me 的意思。

然後，團隊成員可能會看到越來越多的 LGTM。至於有沒有真的看程式碼，就自由心證了。

### 合作無間

在強制要求 code review 的團隊中，可能會在 CI/CD pipeline 裡面加入一個卡控規則：至少要有另一個人的 review 和 approve，CI/CD pipeline 才能往下執行。

這可能演變出一種行為：兩個好朋友之間彼此搭配合作，讓 PR 迅速過關。實際的操作可能是發私訊給夥伴，跟對方說：

「哈囉，我剛剛發了 PR，可以幫我 approve 一下嗎？」

然後，可能就會有某一位團隊成員感到納悶：「為什麼有些人的 PR 總是一個小時內就 approve 了，我的 PR 卻常常要等一兩天？」

### 粗魯的評論

透過 code review 所獲得的修改建議都一定是好的、對的嗎？不一定。我們甚至可能會收到到一些粗心的，甚至粗魯的 review 建議。

以下列舉幾種可能碰到的情形：

1. 僅挑枝微末節的毛病，卻忽略其中有更重要、需要修改的地方。
2. 凸顯存在感和個人貢獻，把焦點往自己身上拉。
3. 忽略客觀與其他面向，只要跟自己習慣不同就要求必須改。
4. 只要求改，不提供具體理由。
5. 陷入面子之爭。

對別人的工作產出提供建議，我覺得是有點嚴肅的事情，而且很容易冒犯到對方。故提出 review 建議的人，我想還是應該盡到說明的責任。提供連結指向 coding standard 或 best practice 也是 ok 的，但如果都不解釋原由，就不大好了。以下舉兩個以較誇張的例子，以凸顯什麼是令人感覺武斷、粗魯的 review 建議：

- This code looks like shit. (:thumbdown)
- Rename `PowerOff` method to `TurnPowerOff`.

Code review 是知識傳遞與彼此溝通想法的過程，其中必然有溝通的藝術成分，這點需要放在心上，以免因為忙碌而忘了基本的尊重和禮貌。當然啦，接受建議的那一方，也不要過於敏感、太容易感到被人冒犯。如果是建設性的建議，保持開放的心胸與對方討論，虛心學習，會是比較好的。

**若有爭議，時時想著「什麼才是對產品最好的」**，並以此前提來思考和回應。

---

這篇筆記就先寫到這裡吧。日後想到什麼再來補。

Keep coding.
